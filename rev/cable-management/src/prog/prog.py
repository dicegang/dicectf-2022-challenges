from sys import argv
from gen import get_key

elec = b"\xec"
tail = b"\xea"
cond = b"\xcd"
halt = b"\x80"
inpt = b"\x11"
accp = b"\x01"
empt = b"\x00"

e = elec
t = tail
i = inpt
a = accp
h = halt
O = cond
_ = empt
r = b"\x33"

flag = b"dice{w0rld_of_w1res_03294803}"

key = get_key(flag)

def stage_xor_1(key):
    global e,t,c,i,a,z,O,_
    rows = [
             _ + _ + _ + _ + _ + _ + _ + _ + _ + _,
             _ + _ + _ + _ + _ + _ + _ + _ + _ + _,
             O + _ + _ + _ + _ + _ + _ + _ + O + i,
             _ + O + _ + _ + _ + _ + _ + O + _ + _,
             _ + O + _ + _ + _ + _ + _ + O + _ + _,
             _ + O + _ + O + O + O + _ + O + _ + _,
             _ + _ + O + O + _ + O + O + _ + _ + r,
             O + _ + _ + O + _ + O + _ + _ + _ + O,
             _ + O + _ + O + O + O + _ + _ + _ + _,
             O + _ + _ + _ + O + _ + _ + _ + _ + O,
             _ + _ + _ + _ + _ + O + _ + _ + O + _,
             _ + O + O + O + _ + O + _ + O + _ + _,
             O + O + _ + O + O + _ + _ + O + _ + O,
             _ + O + _ + O + _ + _ + O + _ + _ + O,
             _ + O + O + O + _ + _ + _ + O + O + _,
             _ + _ + O + _ + _ + _ + _ + _ + _ + _,
             _ + O + O + O + _ + _ + _ + _ + _ + _,
             _ + O + _ + O + _ + _ + _ + _ + _ + _,
             _ + _ + O + _ + _ + _ + _ + _ + _ + _,
             _ + _ + _ + O + _ + O + O + _ + _ + _,
             O + O + O + _ + O + _ + O + O + O + O,
             _ + _ + _ + _ + _ + O + O + _ + _ + _,
             _ + _ + _ + _ + _ + _ + _ + _ + _ + _,
             _ + _ + _ + _ + _ + _ + _ + _ + _ + _,
             _ + _ + _ + _ + _ + _ + _ + _ + _ + _,
             _ + _ + _ + _ + _ + _ + _ + _ + _ + _,
        ]

    rows_end = [
             _ + _ + _ + _ + _ + _ + _ + _ + _ + _,
             _ + _ + _ + _ + _ + _ + _ + _ + _ + _,
             O + _ + _ + _ + _ + _ + _ + _ + O + i,
             _ + O + _ + _ + _ + _ + _ + O + _ + _,
             _ + O + _ + _ + _ + _ + _ + O + _ + _,
             _ + O + _ + O + O + O + _ + O + _ + _,
             _ + _ + O + O + _ + O + O + _ + _ + r,
             O + _ + _ + O + _ + O + _ + _ + _ + O,
             _ + O + _ + O + O + O + _ + _ + _ + _,
             O + _ + _ + _ + O + _ + _ + _ + _ + O,
             _ + _ + _ + _ + _ + O + _ + _ + O + _,
             _ + O + O + O + _ + O + _ + O + _ + _,
             O + O + _ + O + O + _ + _ + O + _ + O,
             _ + O + _ + O + _ + _ + O + _ + _ + O,
             _ + O + O + O + _ + _ + _ + O + O + _,
             _ + _ + O + _ + _ + _ + _ + _ + _ + _,
             _ + O + O + O + _ + _ + _ + _ + _ + _,
             _ + O + _ + O + _ + _ + _ + _ + _ + _,
             _ + _ + O + _ + _ + _ + _ + _ + _ + _,
             _ + _ + _ + O + _ + O + O + _ + _ + _,
             _ + _ + O + _ + O + _ + O + O + O + O,
             _ + _ + _ + O + _ + O + O + _ + _ + _,
             _ + _ + _ + O + _ + _ + _ + _ + _ + _,
             _ + _ + _ + _ + O + O + O + O + O + h,
             _ + _ + _ + _ + _ + _ + _ + _ + _ + _,
             _ + _ + _ + _ + _ + _ + _ + _ + _ + _,
        ]

    end = [
            _ + _ + _ + _,
            _ + _ + _ + _,
            _ + _ + _ + _,
            _ + _ + _ + _,
            _ + _ + _ + _,
            _ + _ + _ + _,
            _ + _ + _ + r,
            _ + _ + _ + O,
            _ + _ + _ + _,
            _ + _ + _ + O,
            _ + _ + O + _,
            _ + O + _ + _,
            _ + O + _ + O,
            O + _ + _ + O,
            _ + O + O + _,
            _ + _ + _ + _,
            _ + _ + _ + _,
            _ + _ + _ + _,
            _ + _ + _ + _,
            _ + _ + _ + _,
            _ + _ + _ + _,
            _ + _ + _ + _,
            _ + _ + _ + _,
            _ + _ + _ + _,
            _ + _ + _ + _,
            _ + _ + _ + _,
            ]


    ret = b""
    for i in range(len(rows)):
        if key[0]:
            text = end[i].replace(r, e)
        else:
            text = end[i].replace(r, O)
        if key[1]:
            text += rows_end[i].replace(r, e)
        else:
            text += rows_end[i].replace(r, O)
        for d in range(len(key) - 2):
            a = b""
            if key[d + 2]:
                a = rows[i].replace(r, e)
            else:
                a = rows[i].replace(r, O)
            text += a 
        ret += text
    return ret

def stage_win_2(r: list):
    rows = [
             _ + _ + _ + _ + _ + _ + _ + _ + _ + _,
             _ + _ + _ + _ + _ + _ + _ + _ + _ + _,
             _ + O + O + O + _ + O + O + O + _ + _,
             _ + O + _ + O + _ + O + _ + O + _ + _,
             _ + O + _ + O + _ + O + _ + O + _ + _,
             _ + O + _ + O + _ + O + _ + O + _ + _,
             _ + O + _ + O + _ + O + _ + O + _ + _,
             _ + O + _ + O + _ + O + _ + O + _ + _,
             _ + O + _ + O + _ + O + _ + O + _ + _,
             _ + O + _ + O + _ + O + _ + O + _ + _,
             _ + O + _ + O + _ + O + _ + O + _ + _,
             _ + O + _ + O + _ + O + _ + O + _ + _,
             _ + O + _ + O + _ + O + _ + O + _ + _,
             _ + O + _ + O + _ + O + _ + O + _ + _,
             _ + O + _ + O + _ + O + _ + O + _ + _,
             _ + O + _ + O + _ + O + _ + O + _ + _,
             _ + O + _ + O + _ + O + _ + O + _ + _,
             _ + O + _ + O + _ + O + _ + O + _ + _,
             _ + O + _ + O + _ + O + _ + O + _ + _,
             _ + O + _ + O + _ + O + _ + O + _ + _,
             _ + O + _ + O + _ + O + _ + O + _ + _,
             O + O + _ + O + O + O + _ + O + O + O,
             _ + _ + _ + _ + _ + _ + _ + _ + _ + _,
             _ + _ + _ + _ + _ + _ + _ + _ + _ + _,
             _ + _ + _ + _ + _ + _ + _ + _ + _ + _,
             _ + _ + _ + _ + _ + _ + _ + _ + _ + _,
        ]

    rows_beg = [
             _ + _ ,
             _ + _ ,
             _ + _ ,
             _ + _ ,
             _ + _ ,
             _ + _ ,
             _ + _ ,
             _ + _ ,
             _ + _ ,
             _ + _ ,
             _ + _ ,
             _ + _ ,
             _ + _ ,
             _ + _ ,
             _ + _ ,
             _ + _ ,
             _ + _ ,
             _ + _ ,
             _ + _ ,
             _ + _ ,
             _ + _ ,
             e + O ,
             _ + _ ,
             _ + _ ,
             _ + _ ,
             _ + _ ,
        ]

    rows_end = [
             _ + _ ,
             _ + _ ,
             _ + _ ,
             _ + _ ,
             _ + _ ,
             _ + _ ,
             _ + _ ,
             _ + _ ,
             _ + _ ,
             _ + _ ,
             _ + _ ,
             _ + _ ,
             _ + _ ,
             _ + _ ,
             _ + _ ,
             _ + _ ,
             _ + _ ,
             _ + _ ,
             _ + _ ,
             _ + _ ,
             _ + _ ,
             O + a ,
             _ + _ ,
             _ + _ ,
             _ + _ ,
             _ + _ ,
        ]

    txt = b""
    for i in range(len(rows)):
        txt += rows_beg[i] + ((len(r) - 1) * rows[i]) + rows_end[i]
    return txt



def fill(x, y):
    return (_ * x) * y



with open(argv[1], "wb") as f: 
    k = [int(a) for a in "".join(format(i, '08b') for i in key)]
    k.append(0)
    print((len(k) - 1) * 10 + 4)
    f.write(stage_win_2(k))
    f.write(stage_xor_1(k))
    f.write(fill(len(k)*10+4, (len(k)*10 + 4) - (26*2)))

